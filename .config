# ============================================================
# OpenWrt V3 Configuration for Intel N100 (x86_64)
# Target: Mac Studio M4 Max Optimized Workflow
# ============================================================

# --- 1. 核心架构与引导 (Intel N100 专用) ---
CONFIG_TARGET_x86=y
CONFIG_TARGET_x86_64=y
CONFIG_TARGET_x86_64_DEVICE_generic=y

# 固件镜像格式 (EFI 引导必备)
CONFIG_GRUB_IMAGES=y
CONFIG_EFI_IMAGES=y
CONFIG_VMDK_IMAGES=y

# --- 存储核心定义 ---
CONFIG_TARGET_KERNEL_PARTSIZE=256
CONFIG_TARGET_ROOTFS_PARTSIZE=1024  # <--- 这里必须是 1024
CONFIG_TARGET_IMAGES_GZ=y

# --- 2. 硬件驱动 (i225/i226 2.5G 网卡与 CPU 微码) ---
CONFIG_PACKAGE_kmod-igc=y
CONFIG_PACKAGE_kmod-e1000e=y
CONFIG_PACKAGE_kmod-r8169=y
CONFIG_PACKAGE_kmod-mii=y
CONFIG_PACKAGE_firmware-intel-microcode=y
CONFIG_PACKAGE_intel-microcode=y

# CPU 加密加速 (AES 指令集，解密流量必备)
CONFIG_PACKAGE_kmod-crypto-aesni=y
CONFIG_PACKAGE_kmod-cryptodev=y

# 多核优化与 KVM 虚拟化支持
CONFIG_PACKAGE_irqbalance=y
CONFIG_PACKAGE_kmod-kvm-intel=y

# --- 3. 存储系统与文件管理 (全格式兼容修复) ---
# 支持所有主流硬盘格式 (NTFS/exFAT/EXT4)
CONFIG_PACKAGE_kmod-fs-ext4=y
CONFIG_PACKAGE_kmod-fs-exfat=y
CONFIG_PACKAGE_kmod-fs-ntfs3=y
CONFIG_PACKAGE_kmod-fs-vfat=y

# USB 3.0 加速协议 (UAS)
CONFIG_PACKAGE_kmod-usb-storage=y
CONFIG_PACKAGE_kmod-usb-storage-uas=y
CONFIG_PACKAGE_kmod-usb3=y

# 磁盘管理工具
CONFIG_PACKAGE_luci-app-diskman=y
CONFIG_PACKAGE_luci-i18n-diskman-zh-cn=y
CONFIG_PACKAGE_fdisk=y
CONFIG_PACKAGE_lsblk=y
CONFIG_PACKAGE_e2fsprogs=y
CONFIG_PACKAGE_smartmontools=y
CONFIG_PACKAGE_partx-utils=y
CONFIG_PACKAGE_mount-utils=y
CONFIG_PACKAGE_automount=y

# --- 4. 网络核心与并发优化 (万兆基石) ---
CONFIG_PACKAGE_kmod-tcp-bbr=y
CONFIG_PACKAGE_kmod-nft-fullconntrack=y
CONFIG_PACKAGE_tcpdump=y

# TurboACC 网络加速
CONFIG_PACKAGE_luci-app-turboacc=y
CONFIG_PACKAGE_luci-app-turboacc_INCLUDE_OFFLOADING=y
CONFIG_PACKAGE_luci-app-turboacc_INCLUDE_BBR_CCA=y
CONFIG_PACKAGE_luci-i18n-turboacc-zh-cn=y

# --- 5. Docker 容器平台 ---
CONFIG_PACKAGE_luci-app-dockerman=y
CONFIG_PACKAGE_luci-i18n-dockerman-zh-cn=y
CONFIG_PACKAGE_docker-ce=y
CONFIG_PACKAGE_containerd=y
CONFIG_PACKAGE_runc=y
CONFIG_PACKAGE_kmod-veth=y
CONFIG_PACKAGE_kmod-ikconfig=y
CONFIG_PACKAGE_kmod-nf-ipvs=y
CONFIG_PACKAGE_cgroupfs-mount=y

# --- 6. 影院级科学网络 (Apple TV 专用) ---
CONFIG_PACKAGE_luci-app-passwall=y
CONFIG_PACKAGE_luci-i18n-passwall-zh-cn=y

# PassWall 组件精简 (去除冲突，保留核心)
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Sing_Box=y
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Xray=y
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Haproxy=y
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_ChinaDNS_NG=y
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Shadowsocks_Libev=y
CONFIG_PACKAGE_xray-plugin=y

# 🚨 强制关闭 Rust 版本以修复依赖报错
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Shadowsocks_Rust=n
CONFIG_PACKAGE_shadowsocks-rust-sslocal=n
CONFIG_PACKAGE_shadowsocks-rust-ssserver=n

# DNS 增强
CONFIG_PACKAGE_luci-app-smartdns=y
CONFIG_PACKAGE_luci-i18n-smartdns-zh-cn=y
CONFIG_PACKAGE_luci-app-adguardhome=y
CONFIG_PACKAGE_luci-i18n-adguardhome-zh-cn=y

# --- 7. 运维监控与辅助工具 ---
# 终端与 Shell
CONFIG_PACKAGE_luci-app-ttyd=y
CONFIG_PACKAGE_luci-i18n-ttyd-zh-cn=y
CONFIG_PACKAGE_curl=y
CONFIG_PACKAGE_wget-ssl=y
CONFIG_PACKAGE_htop=y
CONFIG_PACKAGE_nano=y
CONFIG_PACKAGE_vim-fuller=y

# 远程管理 (ZeroTier)
CONFIG_PACKAGE_luci-app-zerotier=y
CONFIG_PACKAGE_luci-i18n-zerotier-zh-cn=y

# 硬件监控 (Netdata)
CONFIG_PACKAGE_luci-app-netdata=y
CONFIG_PACKAGE_luci-i18n-netdata-zh-cn=y
CONFIG_PACKAGE_collectd-mod-thermal=y
CONFIG_PACKAGE_luci-app-statistics=y

# 内存优化 (ZRAM)
CONFIG_PACKAGE_zram-swap=y
CONFIG_PACKAGE_kmod-zram=y

# SSL 证书支持
CONFIG_PACKAGE_ca-bundle=y
CONFIG_PACKAGE_ca-certificates=y

# --- 8. 界面主题 (Argon) ---
CONFIG_PACKAGE_luci-theme-argon=y
CONFIG_PACKAGE_luci-app-argon-config=y
CONFIG_PACKAGE_luci-i18n-argon-config-zh-cn=y
CONFIG_PACKAGE_luci-i18n-base-zh-cn=y

# --- 9. 安全屏蔽 (防止 V2 崩溃复现) ---
# 关闭所有不必要的内核模块自动选择
# CONFIG_ALL_KMODS is not set
# 移除可能冲突的组件
# CONFIG_PACKAGE_openvswitch is not set
