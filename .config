# ============================================================
# OpenWrt V3 Configuration for Intel N100 (x86_64)
# Target: Mac Studio M4 Max Optimized Workflow
# ============================================================

# --- 1. 核心架构与引导 ---
CONFIG_TARGET_x86=y
CONFIG_TARGET_x86_64=y
CONFIG_TARGET_x86_64_DEVICE_generic=y
CONFIG_GRUB_IMAGES=y
CONFIG_EFI_IMAGES=y
CONFIG_VMDK_IMAGES=y
CONFIG_TARGET_KERNEL_PARTSIZE=256
CONFIG_TARGET_ROOTFS_PARTSIZE=1024
CONFIG_TARGET_IMAGES_GZ=y

# --- 2. N100 必须驱动 (2.5G 网卡 + CPU) ---
CONFIG_PACKAGE_kmod-igc=y
CONFIG_PACKAGE_kmod-e1000e=y
CONFIG_PACKAGE_kmod-r8169=y
CONFIG_PACKAGE_kmod-mii=y
CONFIG_PACKAGE_firmware-intel-microcode=y
CONFIG_PACKAGE_intel-microcode=y
CONFIG_PACKAGE_kmod-crypto-aesni=y
CONFIG_PACKAGE_kmod-cryptodev=y
CONFIG_PACKAGE_irqbalance=y
CONFIG_PACKAGE_kmod-kvm-intel=y

# --- 3. 存储全兼容 (保留基础，Docker 依赖内核模块) ---
CONFIG_PACKAGE_kmod-fs-ext4=y
CONFIG_PACKAGE_kmod-fs-exfat=y
CONFIG_PACKAGE_kmod-fs-ntfs3=y
CONFIG_PACKAGE_kmod-usb-storage=y
CONFIG_PACKAGE_kmod-usb-storage-uas=y
CONFIG_PACKAGE_kmod-usb3=y
CONFIG_PACKAGE_luci-app-diskman=y
CONFIG_PACKAGE_luci-i18n-diskman-zh-cn=y
CONFIG_PACKAGE_mount-utils=y
CONFIG_PACKAGE_automount=y

# --- 4. 网络优化 (保留) ---
CONFIG_PACKAGE_kmod-tcp-bbr=y
CONFIG_PACKAGE_luci-app-turboacc=y
CONFIG_PACKAGE_luci-app-turboacc_INCLUDE_OFFLOADING=y
CONFIG_PACKAGE_luci-app-turboacc_INCLUDE_BBR_CCA=y
CONFIG_PACKAGE_luci-i18n-turboacc-zh-cn=y

# --- 5. 战术调整：移除 Docker/Netdata 编译项 ---
# (这些软件太重，会导致编译失败。刷机后通过 opkg install 安装即可)
# CONFIG_PACKAGE_luci-app-dockerman is not set
# CONFIG_PACKAGE_docker-ce is not set
# CONFIG_PACKAGE_luci-app-netdata is not set

# *但是* 我们保留 Docker 运行所需的内核支持，方便后续安装 *
CONFIG_PACKAGE_kmod-veth=y
CONFIG_PACKAGE_kmod-ikconfig=y
CONFIG_PACKAGE_kmod-nf-ipvs=y
CONFIG_PACKAGE_cgroupfs-mount=y

# --- 6. 科学网络 (核心插件必须编译) ---
CONFIG_PACKAGE_luci-app-passwall=y
CONFIG_PACKAGE_luci-i18n-passwall-zh-cn=y
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Sing_Box=y
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Xray=y
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Haproxy=y
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_ChinaDNS_NG=y
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Shadowsocks_Libev=y
CONFIG_PACKAGE_xray-plugin=y
# 彻底关闭 Rust 依赖
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Shadowsocks_Rust=n
CONFIG_PACKAGE_shadowsocks-rust-sslocal=n
CONFIG_PACKAGE_shadowsocks-rust-ssserver=n

# --- 7. 辅助工具 ---
CONFIG_PACKAGE_luci-app-ttyd=y
CONFIG_PACKAGE_luci-i18n-ttyd-zh-cn=y
CONFIG_PACKAGE_curl=y
CONFIG_PACKAGE_htop=y
CONFIG_PACKAGE_nano=y
# ZeroTier 还是编译进去比较方便
CONFIG_PACKAGE_luci-app-zerotier=y
CONFIG_PACKAGE_luci-i18n-zerotier-zh-cn=y

# --- 8. 主题 ---
CONFIG_PACKAGE_luci-theme-argon=y
CONFIG_PACKAGE_luci-app-argon-config=y
CONFIG_PACKAGE_luci-i18n-argon-config-zh-cn=y
CONFIG_PACKAGE_luci-i18n-base-zh-cn=y

# 9. 解锁 N100 核显 (为 Docker 里的 Jellyfin/Plex 准备)
CONFIG_PACKAGE_intel-media-driver=y
CONFIG_PACKAGE_libva-intel-driver=y
CONFIG_PACKAGE_libva-utils=y
# 确保 i915 驱动加载 (通常默认有，但强制选中更稳)
CONFIG_PACKAGE_kmod-drm-i915=y

# 10. WireGuard 内核级 VPN (回家模式必备)
CONFIG_PACKAGE_kmod-wireguard=y
CONFIG_PACKAGE_luci-proto-wireguard=y
CONFIG_PACKAGE_wireguard-tools=y

# 11. USB 2.5G 网卡驱动 (RTL8156/8152 扩展备用)
CONFIG_PACKAGE_kmod-usb-net=y
CONFIG_PACKAGE_kmod-usb-net-rtl8152=y
CONFIG_PACKAGE_kmod-usb-net-asix-ax88179=y

# 12. 挂载远程 NAS 共享 (CIFS/SMB)
CONFIG_PACKAGE_kmod-fs-cifs=y
CONFIG_PACKAGE_kmod-fs-nfs=y
CONFIG_PACKAGE_kmod-fs-nfs-common=y
