# ============================================================
# ImmortalWrt V3 (N100 Custom Build) - Final Clean
# Strategy: Core + Drivers + PassWall (Stable)
# Target: Intel N100 (x86_64)
# ============================================================

# --- 1. 核心架构与引导 ---
CONFIG_TARGET_x86=y
CONFIG_TARGET_x86_64=y
CONFIG_TARGET_x86_64_DEVICE_generic=y
CONFIG_GRUB_IMAGES=y
CONFIG_EFI_IMAGES=y
CONFIG_VMDK_IMAGES=y
CONFIG_TARGET_KERNEL_PARTSIZE=512
CONFIG_TARGET_ROOTFS_PARTSIZE=1024
CONFIG_TARGET_IMAGES_GZ=y

# --- 2. N100 必备驱动 (CPU & 2.5G 网卡) ---
CONFIG_PACKAGE_kmod-igc=y
CONFIG_PACKAGE_kmod-e1000e=y
CONFIG_PACKAGE_kmod-r8169=y
CONFIG_PACKAGE_kmod-mii=y
CONFIG_PACKAGE_firmware-intel-microcode=y
CONFIG_PACKAGE_intel-microcode=y
CONFIG_PACKAGE_kmod-crypto-aesni=y
CONFIG_PACKAGE_kmod-cryptodev=y
CONFIG_PACKAGE_irqbalance=y
CONFIG_PACKAGE_kmod-kvm-intel=y

# --- 3. N100 核显硬解支持 (Docker 媒体库必备) ---
# 开启后，Jellyfin/Plex 可调用 /dev/dri/renderD128
CONFIG_PACKAGE_intel-media-driver=y
CONFIG_PACKAGE_libva-intel-driver=y
CONFIG_PACKAGE_libva-utils=y
CONFIG_PACKAGE_kmod-drm-i915=y

# --- 4. 存储与文件系统 (支持 NAS 挂载) ---
CONFIG_PACKAGE_kmod-fs-ext4=y
CONFIG_PACKAGE_kmod-fs-exfat=y
CONFIG_PACKAGE_kmod-fs-ntfs3=y
CONFIG_PACKAGE_kmod-usb-storage=y
CONFIG_PACKAGE_kmod-usb-storage-uas=y
CONFIG_PACKAGE_kmod-usb3=y
CONFIG_PACKAGE_luci-app-diskman=y
CONFIG_PACKAGE_luci-i18n-diskman-zh-cn=y
CONFIG_PACKAGE_mount-utils=y
CONFIG_PACKAGE_automount=y
# 挂载远程 SMB/NFS (连接 Z423 NAS)
CONFIG_PACKAGE_kmod-fs-cifs=y
CONFIG_PACKAGE_kmod-fs-nfs=y
CONFIG_PACKAGE_kmod-fs-nfs-common=y

# --- 5. 网络扩展 (USB 网卡 & WireGuard) ---
# USB 2.5G 网卡驱动 (RTL8156/8152)
CONFIG_PACKAGE_kmod-usb-net=y
CONFIG_PACKAGE_kmod-usb-net-rtl8152=y
CONFIG_PACKAGE_kmod-usb-net-asix-ax88179=y
# WireGuard 内核级 VPN (回家模式)
CONFIG_PACKAGE_kmod-wireguard=y
CONFIG_PACKAGE_luci-proto-wireguard=y
CONFIG_PACKAGE_wireguard-tools=y

# --- 6. 网络优化 ---
CONFIG_PACKAGE_kmod-tcp-bbr=y
CONFIG_PACKAGE_luci-app-turboacc=y
CONFIG_PACKAGE_luci-app-turboacc_INCLUDE_OFFLOADING=y
CONFIG_PACKAGE_luci-app-turboacc_INCLUDE_BBR_CCA=y
CONFIG_PACKAGE_luci-i18n-turboacc-zh-cn=y

# --- 7. 战术调整：移除重型编译项 (防爆仓/报错) ---
# 移除编译版 Docker/Netdata (刷机后通过 opkg install 安装)
# CONFIG_PACKAGE_luci-app-dockerman is not set
# CONFIG_PACKAGE_docker-ce is not set
# CONFIG_PACKAGE_luci-app-netdata is not set
# 但保留 Docker 内核支持
CONFIG_PACKAGE_kmod-veth=y
CONFIG_PACKAGE_kmod-ikconfig=y
CONFIG_PACKAGE_kmod-nf-ipvs=y
CONFIG_PACKAGE_cgroupfs-mount=y

# --- 8. 科学网络 PassWall (精简稳定版) ---
CONFIG_PACKAGE_luci-app-passwall=y
CONFIG_PACKAGE_luci-i18n-passwall-zh-cn=y
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Sing_Box=y
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Xray=y
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Haproxy=y
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_ChinaDNS_NG=y
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Shadowsocks_Libev=y

# [CRITICAL] 移除 Go/Rust 巨型插件 (防止 No space left on device)
CONFIG_PACKAGE_v2ray-plugin=n
CONFIG_PACKAGE_xray-plugin=n
CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Shadowsocks_Rust=n
CONFIG_PACKAGE_shadowsocks-rust-sslocal=n
CONFIG_PACKAGE_shadowsocks-rust-ssserver=n

# --- 9. 常用工具 ---
CONFIG_PACKAGE_luci-app-ttyd=y
CONFIG_PACKAGE_luci-i18n-ttyd-zh-cn=y
CONFIG_PACKAGE_curl=y
CONFIG_PACKAGE_htop=y
CONFIG_PACKAGE_nano=y
CONFIG_PACKAGE_luci-app-zerotier=y
CONFIG_PACKAGE_luci-i18n-zerotier-zh-cn=y

# --- 10. 主题 ---
CONFIG_PACKAGE_luci-theme-argon=y
CONFIG_PACKAGE_luci-app-argon-config=y
CONFIG_PACKAGE_luci-i18n-argon-config-zh-cn=y
CONFIG_PACKAGE_luci-i18n-base-zh-cn=y
